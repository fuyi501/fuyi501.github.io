(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{744:function(t,s,a){"use strict";a.r(s);var n=a(104),r=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"_1-使用-ffmpeg-命令推流"}},[t._v("1. 使用 ffmpeg 命令推流 "),a("a",{staticClass:"header-anchor",attrs:{href:"#_1-使用-ffmpeg-命令推流"}},[t._v("#")])]),t._v(" "),a("h3",{attrs:{id:"准备视频流地址或者视频文件都可以"}},[t._v("准备视频流地址或者视频文件都可以 "),a("a",{staticClass:"header-anchor",attrs:{href:"#准备视频流地址或者视频文件都可以"}},[t._v("#")])]),t._v(" "),a("p",[t._v("比如我使用的是海康摄像头，地址为：")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("rtsp://admin:123456@192.168.9.33:554/Streaming/Channels/101\n")])])]),a("h3",{attrs:{id:"ffmpeg-推流命令"}},[t._v("ffmpeg 推流命令 "),a("a",{staticClass:"header-anchor",attrs:{href:"#ffmpeg-推流命令"}},[t._v("#")])]),t._v(" "),a("p",[t._v("当然前提是你已经搭建好了 视频流服务器。")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("ffmpeg -i rtsp://admin:swjtu9422@192.168.9.33:554/Streaming/Channels/101 -f mp4 -vcodec copy -r "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("25")]),t._v(" -s "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1920")]),t._v("*1080 -b:v "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024000")]),t._v(" -an -f flv -an rtmp://192.168.9.12:1935/live/stream\n")])])]),a("h2",{attrs:{id:"_2-nodejs-使用-fluent-ffmpeg-推流"}},[t._v("2. Nodejs 使用 fluent-ffmpeg 推流 "),a("a",{staticClass:"header-anchor",attrs:{href:"#_2-nodejs-使用-fluent-ffmpeg-推流"}},[t._v("#")])]),t._v(" "),a("p",[t._v("nodejs 安装 fluent-ffmpeg 模块，使用 fluent-ffmpeg 模块执行 ffmpeg 命令完成推流")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 安装")]),t._v("\nnpm i fluent"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("ffmpeg\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 使用")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" inputPath "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'rtsp://admin:swjtu9422@192.168.9.34:554/Streaming/Channels/101'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" outPath "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'rtmp://192.168.9.12:1935/live/stream'")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ffmpeg")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("inputPath"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// .inputOptions('-re')")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'start'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("commandLine")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ffmpeg 命令: '")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" commandLine"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'error'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("err"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("stdout"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" stderr")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'error: '")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" err"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("message"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'stdout: '")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" stdout"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'stderr: '")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" stderr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// .on('progress', function (progress) {")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//     console.log('progressing: ', progress.percent , ' % done')")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// })")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'stderr'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("stderrLine")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'output: '")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" stderrLine"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'end'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'完成 '")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("addOptions")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// '-vcodec h264',")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'-f mp4'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'-an'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'-vcodec copy'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'-r 25'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'-s 1920*1080'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'-b:v 1024000'")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// '-vcodec libx264',")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// '-c:a aac',")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// '-bufsize 3000k',")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// '-max_muxing_queue_size 1024',")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// '-preset veryfast', // 牺牲视频质量，换取流畅性")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// '-ac 2', // 双声道输出")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// '-ar 44100' // 音频采样率")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// .noAudio()")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// .videoCodec('copy')")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("format")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'flv'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// .format('h264')")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// .pipe(outPath, {end: true})")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("output")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("outPath"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 使用 pipe 管道 ，output 和 run 不可用")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("run")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("h3",{attrs:{id:"_1-原视频流-rtsp-播放测试"}},[t._v("1. 原视频流 rtsp 播放测试 "),a("a",{staticClass:"header-anchor",attrs:{href:"#_1-原视频流-rtsp-播放测试"}},[t._v("#")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://img.fuwenwei.com/blog/rtsp%E6%92%AD%E6%94%BE2.png",alt:""}})]),t._v(" "),a("h3",{attrs:{id:"_2-rtmp-播放"}},[t._v("2. rtmp 播放 "),a("a",{staticClass:"header-anchor",attrs:{href:"#_2-rtmp-播放"}},[t._v("#")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://img.fuwenwei.com/blog/rtmp%E6%92%AD%E6%94%BE.png",alt:""}})]),t._v(" "),a("h3",{attrs:{id:"_3-hls-播放"}},[t._v("3. hls 播放 "),a("a",{staticClass:"header-anchor",attrs:{href:"#_3-hls-播放"}},[t._v("#")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://img.fuwenwei.com/blog/m3u8%E6%92%AD%E6%94%BE.png",alt:""}})]),t._v(" "),a("h3",{attrs:{id:"_4-http-flv-播放"}},[t._v("4. http-flv 播放 "),a("a",{staticClass:"header-anchor",attrs:{href:"#_4-http-flv-播放"}},[t._v("#")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://img.fuwenwei.com/blog/http-flv%E6%92%AD%E6%94%BE.png",alt:""}})]),t._v(" "),a("h3",{attrs:{id:"_5-http-flv和rtmp和rtsp播放延时对比"}},[t._v("5. http-flv和rtmp和rtsp播放延时对比 "),a("a",{staticClass:"header-anchor",attrs:{href:"#_5-http-flv和rtmp和rtsp播放延时对比"}},[t._v("#")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://img.fuwenwei.com/blog/http-flv%E5%92%8Crtmp%E5%92%8Crtsp%E6%92%AD%E6%94%BE%E5%BB%B6%E6%97%B6%E5%AF%B9%E6%AF%94.png",alt:""}})]),t._v(" "),a("h3",{attrs:{id:"_6-hls和rtmp和rtsp播放延时对比"}},[t._v("6. hls和rtmp和rtsp播放延时对比 "),a("a",{staticClass:"header-anchor",attrs:{href:"#_6-hls和rtmp和rtsp播放延时对比"}},[t._v("#")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://img.fuwenwei.com/blog/m3u8%E5%92%8Crtmp%E5%92%8Crtsp%E6%92%AD%E6%94%BE%E5%BB%B6%E6%97%B6%E5%AF%B9%E6%AF%94.png",alt:""}})]),t._v(" "),a("h3",{attrs:{id:"_7-http-flv和m3u8播放延时对比"}},[t._v("7. http-flv和m3u8播放延时对比 "),a("a",{staticClass:"header-anchor",attrs:{href:"#_7-http-flv和m3u8播放延时对比"}},[t._v("#")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://img.fuwenwei.com/blog/http-flv%E5%92%8Cm3u8%E6%92%AD%E6%94%BE%E5%BB%B6%E6%97%B6%E5%AF%B9%E6%AF%94.png",alt:""}})]),t._v(" "),a("h2",{attrs:{id:"播放地址"}},[t._v("播放地址 "),a("a",{staticClass:"header-anchor",attrs:{href:"#播放地址"}},[t._v("#")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("rtsp://admin:123456@192.168.9.33:554/Streaming/Channels/101\n\nrtmp://192.168.9.12:1935/live/stream\nhttp://192.168.9.12:8080/live?app=live&stream=stream\n\nrtmp://192.168.9.12:1935/hls/stream\nhttp://192.168.9.12:8080/hls/stream.m3u8\n")])])])])}),[],!1,null,null,null);s.default=r.exports}}]);