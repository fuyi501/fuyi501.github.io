(window.webpackJsonp=window.webpackJsonp||[]).push([[28],{755:function(t,s,n){"use strict";n.r(s);var a=n(104),e=Object(a.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h2",{attrs:{id:"python-数据库-api-对象"}},[t._v("python 数据库 api 对象 "),n("a",{staticClass:"header-anchor",attrs:{href:"#python-数据库-api-对象"}},[t._v("#")])]),t._v(" "),n("p",[t._v("在 python 中，和 mysql 数据库有关的对象主要有三个，就是")]),t._v(" "),n("ul",[n("li",[t._v("connection连接对象")]),t._v(" "),n("li",[t._v("数据库交互对象 cursor")]),t._v(" "),n("li",[t._v("异常对象 exceptions")])]),t._v(" "),n("p",[n("img",{attrs:{src:"http://images.fuyix.cn/pythonApi.png",alt:"enter description here",title:"pythonApi"}})]),t._v(" "),n("h2",{attrs:{id:"访问数据库基本流程"}},[t._v("访问数据库基本流程 "),n("a",{staticClass:"header-anchor",attrs:{href:"#访问数据库基本流程"}},[t._v("#")])]),t._v(" "),n("p",[n("img",{attrs:{src:"http://images.fuyix.cn/python%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93%E6%B5%81%E7%A8%8B.png",alt:"enter description here",title:"python访问数据库流程"}})]),t._v(" "),n("h2",{attrs:{id:"数据库连接对象-connection"}},[t._v("数据库连接对象 connection "),n("a",{staticClass:"header-anchor",attrs:{href:"#数据库连接对象-connection"}},[t._v("#")])]),t._v(" "),n("p",[t._v("使用 connect 方法来连接 mysql 数据库，connect 参数如下：")]),t._v(" "),n("p",[n("img",{attrs:{src:"http://images.fuyix.cn/%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5%E5%AF%B9%E8%B1%A1connection.png",alt:"enter description here",title:"数据库连接对象connection"}})]),t._v(" "),n("p",[t._v("connection 对象有以下四个主要的方法，具体用法下面再讲。")]),t._v(" "),n("p",[n("img",{attrs:{src:"http://images.fuyix.cn/connection%E5%AF%B9%E5%BA%94%E7%9A%84%E6%96%B9%E6%B3%95.png",alt:"enter description here",title:"connection对应的方法"}})]),t._v(" "),n("h3",{attrs:{id:"数据库连接实例代码"}},[t._v("数据库连接实例代码： "),n("a",{staticClass:"header-anchor",attrs:{href:"#数据库连接实例代码"}},[t._v("#")])]),t._v(" "),n("div",{staticClass:"language-python extra-class"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# -*- coding: UTF-8 -*-")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" MySQLdb "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" mdb\n\nconn "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" mdb"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("connect"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  host"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'127.0.0.1'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n  port"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3306")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n  user"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'root'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  passwd"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'123456'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n  db"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'test'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n  charset"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'utf8'")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\ncursor "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" conn"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cursor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),t._v(" cursor\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),t._v(" conn\ncursor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("close"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nconn"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("close"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n")])])]),n("h2",{attrs:{id:"数据库游标对象-cursor"}},[t._v("数据库游标对象 cursor "),n("a",{staticClass:"header-anchor",attrs:{href:"#数据库游标对象-cursor"}},[t._v("#")])]),t._v(" "),n("h3",{attrs:{id:"cursor-对象主要有以下几个方法"}},[t._v("cursor 对象主要有以下几个方法 "),n("a",{staticClass:"header-anchor",attrs:{href:"#cursor-对象主要有以下几个方法"}},[t._v("#")])]),t._v(" "),n("p",[n("img",{attrs:{src:"http://images.fuyix.cn/%E6%B8%B8%E6%A0%87%E5%AF%B9%E8%B1%A1cursor.png",alt:"enter description here",title:"游标对象cursor"}})]),t._v(" "),n("h3",{attrs:{id:"execute-方法"}},[t._v("execute 方法 "),n("a",{staticClass:"header-anchor",attrs:{href:"#execute-方法"}},[t._v("#")])]),t._v(" "),n("p",[n("img",{attrs:{src:"http://images.fuyix.cn/execute%E6%96%B9%E6%B3%95.png",alt:"enter description here",title:"execute方法"}})]),t._v(" "),n("h3",{attrs:{id:"fetch-方法"}},[t._v("fetch() 方法 "),n("a",{staticClass:"header-anchor",attrs:{href:"#fetch-方法"}},[t._v("#")])]),t._v(" "),n("p",[n("img",{attrs:{src:"http://images.fuyix.cn/fetch%E6%96%B9%E6%B3%95%E4%BB%8B%E7%BB%8D.png",alt:"enter description here",title:"fetch方法介绍"}})]),t._v(" "),n("h2",{attrs:{id:"python-操作数据库实例演示"}},[t._v("python 操作数据库实例演示 "),n("a",{staticClass:"header-anchor",attrs:{href:"#python-操作数据库实例演示"}},[t._v("#")])]),t._v(" "),n("h3",{attrs:{id:"select-查询数据"}},[t._v("select 查询数据 "),n("a",{staticClass:"header-anchor",attrs:{href:"#select-查询数据"}},[t._v("#")])]),t._v(" "),n("p",[n("img",{attrs:{src:"http://images.fuyix.cn/select%E6%9F%A5%E8%AF%A2%E6%95%B0%E6%8D%AE.png",alt:"enter description here",title:"select查询数据"}})]),t._v(" "),n("p",[t._v("首先需要准备好一个数据库，数据库名为 "),n("code",[t._v("test")]),t._v("，数据库中有 "),n("code",[t._v("students")]),t._v(" 表，我们先插入了一些数据，如下图所示：")]),t._v(" "),n("p",[n("img",{attrs:{src:"http://images.fuyix.cn/python-mysql%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E4%BE%8B.png",alt:"enter description here",title:"python-mysql数据库实例"}})]),t._v(" "),n("h3",{attrs:{id:"实例代码"}},[t._v("实例代码： "),n("a",{staticClass:"header-anchor",attrs:{href:"#实例代码"}},[t._v("#")])]),t._v(" "),n("div",{staticClass:"language-python extra-class"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# -*- coding: UTF-8 -*-")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" MySQLdb "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" mdb\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 也可以使用关键字参数")]),t._v("\nconn "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" mdb"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("connect"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  host"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'127.0.0.1'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n  port"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3306")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n  user"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'root'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  passwd"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'123456'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n  db"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'test'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n  charset"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'utf8'")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\ncursor "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" conn"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cursor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nsql "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"select * from students"')]),t._v("\ncursor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("execute"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sql"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),t._v(" cursor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("rowcount\nrs "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" cursor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("fetchall"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" row "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" rs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"id = %d , name=%s , sex=%s"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v(" row\n\nrs "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" cursor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("fetchone"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),t._v(" rs\nrs "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" cursor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("fetchmany"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),t._v(" rs\nrs "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" cursor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("fetchall"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),t._v(" rs\ncursor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("close"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nconn"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("close"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),n("h3",{attrs:{id:"增删改查-数据库"}},[t._v("增删改查 数据库 "),n("a",{staticClass:"header-anchor",attrs:{href:"#增删改查-数据库"}},[t._v("#")])]),t._v(" "),n("h4",{attrs:{id:"增删改查数据库的一般流程"}},[t._v("增删改查数据库的一般流程 "),n("a",{staticClass:"header-anchor",attrs:{href:"#增删改查数据库的一般流程"}},[t._v("#")])]),t._v(" "),n("p",[n("img",{attrs:{src:"http://images.fuyix.cn/python-%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5%E6%95%B0%E6%8D%AE%E5%BA%93.png",alt:"enter description here",title:"python-增删改查数据库"}})]),t._v(" "),n("h4",{attrs:{id:"什么是事务"}},[t._v("什么是事务？ "),n("a",{staticClass:"header-anchor",attrs:{href:"#什么是事务"}},[t._v("#")])]),t._v(" "),n("p",[n("img",{attrs:{src:"http://images.fuyix.cn/python-%E6%95%B0%E6%8D%AE%E5%BA%93-%E4%BA%8B%E5%8A%A1.png",alt:"enter description here",title:"python-数据库-事务"}})]),t._v(" "),n("p",[t._v("举例来说明commit，rollback方法怎么使用")]),t._v(" "),n("div",{staticClass:"language-python extra-class"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# -*- coding: UTF-8 -*-")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" MySQLdb "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" mdb\n\nconn "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" mdb"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("connect"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  host"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'127.0.0.1'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n  port"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3306")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n  user"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'root'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  passwd"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'123456'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n  db"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'test'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n  charset"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'utf8'")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\ncursor "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" conn"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cursor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nsql "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"select * from students"')]),t._v("\n\nsql_insert "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('\'insert into students(id,sname,sex) values(7, "sdf", "男")\'')]),t._v("\nsql_update "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'update students set sname=\"李雄\" where id=4'")]),t._v("\nsql_delete "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'delete from students where id<3'")]),t._v("\n\ncursor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("execute"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sql"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 执行查询语句")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),t._v(" cursor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("rowcount  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看执行 execute 方法导致mysql数据库有多少条数据发生了改变")]),t._v("\ncursor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("execute"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sql_insert"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 执行插入语句")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),t._v(" cursor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("rowcount   "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看执行 execute 方法导致mysql数据库有多少条数据发生了改变")]),t._v("\ncursor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("execute"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sql_update"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 执行更新语句")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),t._v(" cursor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("rowcount   "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看执行 execute 方法导致mysql数据库有多少条数据发生了改变")]),t._v("\ncursor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("execute"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sql_delete"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 执行删除语句")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),t._v(" cursor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("rowcount   "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看执行 execute 方法导致mysql数据库有多少条数据发生了改变")]),t._v("\n\ncursor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("close"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nconn"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("close"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),n("p",[t._v("在上面的代码中，我们执行了 4 条sql语句，执行结果为 "),n("code",[t._v("5、 1、 1、 1")]),t._v("，因为我们的数据库中只有 5 条数据，所以第一条查询语句生效的有 5 条数据，后面三条语句，导致数据库更改的都只有一条数据，所以输出都为 1 。")]),t._v(" "),n("p",[t._v("但是这时，我们来看数据库，发现数据库并没有改变：")]),t._v(" "),n("p",[n("img",{attrs:{src:"http://images.fuyix.cn/python-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%9C%AA%E6%9B%B4%E6%94%B9.png",alt:"enter description here",title:"python-数据库未更改"}})]),t._v(" "),n("p",[t._v("这是为什么呢？原因就是我们需要提交事务，使用 commit 方法提交 sql 语句的改变，才能真正更改数据库。如下代码，添加一条语句  "),n("code",[t._v("conn.commit()")]),t._v("，再执行一次")]),t._v(" "),n("div",{staticClass:"language-python extra-class"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 上面代码省略，如上面一致。")]),t._v("\n\ncursor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("execute"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sql"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 执行查询语句")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),t._v(" cursor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("rowcount  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看执行 execute 方法导致mysql数据库有多少条数据发生了改变")]),t._v("\ncursor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("execute"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sql_insert"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 执行插入语句")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),t._v(" cursor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("rowcount   "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看执行 execute 方法导致mysql数据库有多少条数据发生了改变")]),t._v("\ncursor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("execute"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sql_update"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 执行更新语句")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),t._v(" cursor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("rowcount   "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看执行 execute 方法导致mysql数据库有多少条数据发生了改变")]),t._v("\ncursor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("execute"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sql_delete"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 执行删除语句")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),t._v(" cursor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("rowcount   "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看执行 execute 方法导致mysql数据库有多少条数据发生了改变")]),t._v("\n\nconn"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("commit"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\ncursor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("close"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nconn"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("close"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),n("p",[t._v("执行之后，再来看数据库中的数据，发生了变化：")]),t._v(" "),n("p",[n("img",{attrs:{src:"http://images.fuyix.cn/python-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%9B%B4%E6%94%B9.png",alt:"enter description here",title:"python-数据库更改"}})]),t._v(" "),n("p",[t._v("这个时候，我们可能会想，如果执行语句有错误怎么办？如果有错误，这样执行了 commit 提交事务，那岂不是破坏了数据库，所以这个时候就需要数据库异常类，当执行sql 语句发生异常时，就需要执行 rollback 方法回滚当前事务，也就是把刚才执行的 sql 语句全部取消，回退到未执行之前的状态，这样就保护了数据库的安全。所以在执行 sql 语句时，我们都需要使用 "),n("code",[t._v("try except")]),t._v(" 把数据库操作语句包含起来，来捕获异常。正常的完整代码如下所示：")]),t._v(" "),n("div",{staticClass:"language-python extra-class"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# -*- coding: UTF-8 -*-")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" MySQLdb "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" mdb\n\nconn "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" mdb"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("connect"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  host"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'127.0.0.1'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n  port"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3306")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n  user"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'root'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  passwd"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'123456'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n  db"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'test'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n  charset"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'utf8'")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\ncursor "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" conn"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cursor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nsql "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"select * from students"')]),t._v("\n\nsql_insert "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('\'insert into students(id,sname,sex) values(7, "sdf", "男")\'')]),t._v("\nsql_update "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'update students set sname=\"李雄\" where id=4'")]),t._v("\nsql_delete "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'delete from students where id<3'")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  cursor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("execute"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sql"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 执行查询语句")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),t._v(" cursor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("rowcount  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看执行 execute 方法导致mysql数据库有多少条数据发生了改变")]),t._v("\n  cursor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("execute"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sql_insert"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 执行插入语句")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),t._v(" cursor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("rowcount   "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看执行 execute 方法导致mysql数据库有多少条数据发生了改变")]),t._v("\n  cursor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("execute"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sql_update"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 执行更新语句")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),t._v(" cursor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("rowcount   "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看执行 execute 方法导致mysql数据库有多少条数据发生了改变")]),t._v("\n  cursor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("execute"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sql_delete"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 执行删除语句")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),t._v(" cursor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("rowcount   "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看执行 execute 方法导致mysql数据库有多少条数据发生了改变")]),t._v("\n\n  conn"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("commit"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 提交事务")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("except")]),t._v(" Exception "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" e"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 捕获异常")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),t._v(" e\n  conn"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("rollback"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 回滚事务")]),t._v("\n\ncursor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("close"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nconn"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("close"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n")])])])])}),[],!1,null,null,null);s.default=e.exports}}]);