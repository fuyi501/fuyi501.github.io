(window.webpackJsonp=window.webpackJsonp||[]).push([[25],{753:function(n,t,s){"use strict";s.r(t);var a=s(104),e=Object(a.a)({},(function(){var n=this,t=n.$createElement,s=n._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":n.$parent.slotKey}},[s("h2",{attrs:{id:"nginx-服务器的配置"}},[n._v("Nginx 服务器的配置 "),s("a",{staticClass:"header-anchor",attrs:{href:"#nginx-服务器的配置"}},[n._v("#")])]),n._v(" "),s("p",[n._v("Nginx 服务器的使用实际上重点就在于它的配置，作为代理服务器，你可以在服务器上启动多个应用，由 Nginx 配置多个域名，实现服务的代理。")]),n._v(" "),s("p",[n._v("服务器系统：ubuntu server 16.04\nnginx 版本号：nginx/1.10.0 (Ubuntu)")]),n._v(" "),s("p",[n._v("登录服务器，进入到 Nginx 的安装目录 "),s("code",[n._v("/etc/nginx/")]),n._v(",可以看到很多文件")]),n._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[n._v("ubuntu@VM-176-3-ubuntu:~$ "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[n._v("cd")]),n._v(" /etc/nginx/\nubuntu@VM-176-3-ubuntu:/etc/nginx$ "),s("span",{pre:!0,attrs:{class:"token function"}},[n._v("ls")]),n._v("\nconf.d          koi-utf     nginx.conf    sites-available  uwsgi_params\nfastcgi.conf    koi-win     proxy_params  sites-enabled    win-utf\nfastcgi_params  mime.types  scgi_params   snippets\n")])])]),s("p",[n._v("其中，"),s("code",[n._v("sites-enabled")]),n._v(" 中存放着 nginx 的默认配置文件， "),s("code",[n._v("conf.d")]),n._v(" 目录存放其他的配置文件，不过目前 "),s("code",[n._v("conf.d")]),n._v(" 目录下是空的，以后可以将自定义的配置文件都放到这个目录下。")]),n._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[n._v("ubuntu@VM-176-3-ubuntu:/etc/nginx$ "),s("span",{pre:!0,attrs:{class:"token function"}},[n._v("ls")]),n._v(" sites-enabled/\ndefault\nubuntu@VM-176-3-ubuntu:/etc/nginx$ "),s("span",{pre:!0,attrs:{class:"token function"}},[n._v("ls")]),n._v(" conf.d/\nubuntu@VM-176-3-ubuntu:/etc/nginx$ \n")])])]),s("p",[n._v("在 nginx 目录下有一个 "),s("code",[n._v("nginx.conf")]),n._v(" 配置文件，里面有这样两句代码：")]),n._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("include /etc/nginx/conf.d/*.conf;\ninclude /etc/nginx/sites-enabled/*;\n")])])]),s("p",[n._v("我们将配置文件放在 "),s("code",[n._v("conf.d")]),n._v(" 目录后，使用命令 "),s("code",[n._v("sudo nginx -s reload")]),n._v(" ，就会重新加载里面所有的配置文件。")]),n._v(" "),s("p",[n._v("下面用两个例子来验证 nginx 服务器的代理转发")]),n._v(" "),s("p",[n._v("一个是 thinkjs 的测试项目，占用端口 8360；一个是 hexo 的测试项目，占用端口4000.")]),n._v(" "),s("p",[n._v("首先在用户目录下下载安装这两个项目，下载好了如下：")]),n._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[n._v("ubuntu@VM-176-3-ubuntu:~$ "),s("span",{pre:!0,attrs:{class:"token function"}},[n._v("ls")]),n._v("\nblog_server  project_test\n")])])]),s("p",[n._v("thinkjs 测试项目自己带有 nginx.conf 配置文件，我们只需要将这个配置文件复制到 "),s("code",[n._v("/etc/nginx/conf.d")]),n._v(" 目录下就可以了，详情请参考官方文档的 "),s("a",{attrs:{href:"https://thinkjs.org/zh-cn/doc/2.2/deploy.html#toc-c69",target:"_blank",rel:"noopener noreferrer"}},[n._v("使用 nginx 做反向代理"),s("OutboundLink")],1),n._v("配置多个域名，实现服务的代理。")]),n._v(" "),s("p",[n._v("hexo 测试项目因为里面没有 index.html 文件，所以要先 执行 "),s("code",[n._v("hexo g")]),n._v(" 来生成静态文件，执行之后会生成一个 public 目录，public 目录下就会有 index.html 文件，然后我们需要为 hexo 项目写一个 conf 文件，内容类似如下：")]),n._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("server {\n    listen 80;\n    server_name blog.fuyix.cn;\n    set $node_port 4000;\n\n    location / {\n\t    proxy_pass http://localhost:$node_port;\n    }\n}\n")])])]),s("p",[n._v("注意：将 "),s("code",[n._v("server_name localhost")]),n._v(" 里的 "),s("code",[n._v("localhost")]),n._v(" 修改为对应的域名，将 "),s("code",[n._v("set $node_port 4000")]),n._v(" 里的 "),s("code",[n._v("4000")]),n._v(" 修改和项目里监听的端口一致。我这里使用默认的 "),s("code",[n._v("4000")]),n._v(" 端口。")]),n._v(" "),s("p",[n._v("然后在 "),s("code",[n._v("/etc/nginx/conf.d")]),n._v(" 目录下新建 hexo_nginx.conf 文件，拷贝上面的代码粘贴在里面，然后保存退出，重新加载 nginx 的配置文件就可以了，如下：")]),n._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[n._v("ubuntu@VM-176-3-ubuntu:/etc/nginx/conf.d$ "),s("span",{pre:!0,attrs:{class:"token function"}},[n._v("ls")]),n._v("\nthinkjs_nginx.conf\nubuntu@VM-176-3-ubuntu:/etc/nginx/conf.d$ "),s("span",{pre:!0,attrs:{class:"token function"}},[n._v("cat")]),n._v(" thinkjs_nginx.conf\nserver "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("{")]),n._v("\n    listen "),s("span",{pre:!0,attrs:{class:"token number"}},[n._v("80")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(";")]),n._v("\n    server_name think.fuyix.cn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(";")]),n._v("\n    root /home/ubuntu/project_test/www"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(";")]),n._v("\n    "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[n._v("set")]),n._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[n._v("$node_port")]),n._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[n._v("8360")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(";")]),n._v("\n\n    index index.js index.html index.htm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(";")]),n._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[n._v("if")]),n._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),n._v(" -f "),s("span",{pre:!0,attrs:{class:"token variable"}},[n._v("$request_filename")]),n._v("/index.html "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("{")]),n._v("\n        rewrite "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),n._v(".*"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),n._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[n._v("$1")]),n._v("/index.html "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[n._v("break")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(";")]),n._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("}")]),n._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[n._v("if")]),n._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),n._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[n._v("!")]),n._v("-f "),s("span",{pre:!0,attrs:{class:"token variable"}},[n._v("$request_filename")]),n._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("{")]),n._v("\n        rewrite "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),n._v(".*"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),n._v(" /index.js"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(";")]),n._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("}")]),n._v("\n    location "),s("span",{pre:!0,attrs:{class:"token operator"}},[n._v("=")]),n._v(" /index.js "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("{")]),n._v("\n        proxy_http_version "),s("span",{pre:!0,attrs:{class:"token number"}},[n._v("1.1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(";")]),n._v("\n        proxy_set_header X-Real-IP "),s("span",{pre:!0,attrs:{class:"token variable"}},[n._v("$remote_addr")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(";")]),n._v("\n        proxy_set_header X-Forwarded-For "),s("span",{pre:!0,attrs:{class:"token variable"}},[n._v("$proxy_add_x_forwarded_for")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(";")]),n._v("\n        proxy_set_header Host "),s("span",{pre:!0,attrs:{class:"token variable"}},[n._v("$http_host")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(";")]),n._v("\n        proxy_set_header X-NginX-Proxy "),s("span",{pre:!0,attrs:{class:"token boolean"}},[n._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(";")]),n._v("\n        proxy_set_header Upgrade "),s("span",{pre:!0,attrs:{class:"token variable"}},[n._v("$http_upgrade")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(";")]),n._v("\n        proxy_set_header Connection "),s("span",{pre:!0,attrs:{class:"token string"}},[n._v('"upgrade"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(";")]),n._v("\n        proxy_pass http://127.0.0.1:"),s("span",{pre:!0,attrs:{class:"token variable"}},[n._v("$node_port")]),s("span",{pre:!0,attrs:{class:"token variable"}},[n._v("$request_uri")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(";")]),n._v("\n        proxy_redirect off"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(";")]),n._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("}")]),n._v("\n    \n    location "),s("span",{pre:!0,attrs:{class:"token operator"}},[n._v("=")]),n._v(" /development.js "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("{")]),n._v("\n        deny all"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(";")]),n._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("}")]),n._v("\n\n    location "),s("span",{pre:!0,attrs:{class:"token operator"}},[n._v("=")]),n._v(" /testing.js "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("{")]),n._v("\n        deny all"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(";")]),n._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("}")]),n._v("\n\n    location "),s("span",{pre:!0,attrs:{class:"token operator"}},[n._v("=")]),n._v(" /production.js "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("{")]),n._v("\n        deny all"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(";")]),n._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("}")]),n._v("\n\n    location ~ /static/ "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("{")]),n._v("\n        etag         on"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(";")]),n._v("\n        expires      max"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(";")]),n._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("}")]),n._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("}")]),n._v("   \nubuntu@VM-176-3-ubuntu:/etc/nginx/conf.d$ "),s("span",{pre:!0,attrs:{class:"token function"}},[n._v("sudo")]),n._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[n._v("vim")]),n._v(" hexo_nginx.conf \nubuntu@VM-176-3-ubuntu:/etc/nginx/conf.d$ "),s("span",{pre:!0,attrs:{class:"token function"}},[n._v("ls")]),n._v("\nhexo_nginx.conf  thinkjs_nginx.conf\nubuntu@VM-176-3-ubuntu:/etc/nginx/conf.d$ "),s("span",{pre:!0,attrs:{class:"token function"}},[n._v("cat")]),n._v(" hexo_nginx.conf \nserver "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("{")]),n._v("\n    listen "),s("span",{pre:!0,attrs:{class:"token number"}},[n._v("80")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(";")]),n._v("\n    server_name blog.fuyix.cn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(";")]),n._v("\n    "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[n._v("set")]),n._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[n._v("$node_port")]),n._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[n._v("4000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(";")]),n._v("\n\n    location / "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("{")]),n._v("\n\t    proxy_pass http://localhost:"),s("span",{pre:!0,attrs:{class:"token variable"}},[n._v("$node_port")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(";")]),n._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("}")]),n._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("}")]),n._v("\nubuntu@VM-176-3-ubuntu:/etc/nginx/conf.d$ "),s("span",{pre:!0,attrs:{class:"token function"}},[n._v("sudo")]),n._v(" nginx -s reload\nubuntu@VM-176-3-ubuntu:/etc/nginx/conf.d$ \n")])])]),s("p",[n._v("注意：这里面的两个域名")]),n._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("server_name think.fuyix.cn;\nserver_name blog.fuyix.cn;\n")])])]),s("p",[n._v("需要到域名管理商那里进行解析的，我把它解析成二级域名了而已：")]),n._v(" "),s("p",[s("img",{attrs:{src:"http://images.fuyix.cn/blog/server_conf_dns.png",alt:"blog/server_conf_dns.png"}})]),n._v(" "),s("p",[n._v("到这里，所有的配置基本就完成了，下面就是启动我们的应用")]),n._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("ubuntu@VM-176-3-ubuntu:~/project_test$ node www/production.js \n[2017-02-24 11:37:57] [PRELOAD] preload packages finished 69ms\n[2017-02-24 11:37:57] [THINK] Server running at http://127.0.0.1:8360/\n[2017-02-24 11:37:57] [THINK] ThinkJS Version: 2.2.17\n[2017-02-24 11:37:57] [THINK] Cluster Status: closed\n[2017-02-24 11:37:57] [THINK] WebSocket Status: closed\n[2017-02-24 11:37:57] [THINK] File Auto Compile: false\n[2017-02-24 11:37:57] [THINK] File Auto Reload: false\n[2017-02-24 11:37:57] [THINK] App Enviroment: production\n\nubuntu@VM-176-3-ubuntu:~/blog_server$ hexo server\nINFO  Start processing\nINFO  Hexo is running at http://localhost:4000/. Press Ctrl+C to stop.\n\n")])])]),s("p",[n._v("然后就是进行域名访问了：")]),n._v(" "),s("p",[s("img",{attrs:{src:"http://images.fuyix.cn/blog/server_conf_thinkjs.png",alt:"blog/server_conf_thinkjs.png"}})]),n._v(" "),s("p",[s("img",{attrs:{src:"http://images.fuyix.cn/blog/server_conf_hexo.png",alt:"blog/server_conf_hexo.png"}})])])}),[],!1,null,null,null);t.default=e.exports}}]);